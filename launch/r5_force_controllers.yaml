# Publish all joint states -----------------------------------
joint_state_controller:
    type: joint_state_controller/JointStateController
    publish_rate: 250 

inverse_dynamics_controller:
    type: inverse_dynamics_controllers/InverseDynamicsController
    required_drive_mode: 7
    control_type: position_controlled # velocity_controlled, torque_controlled
    world_name: world #base
    root_name:  base_link
    tip_name:   link_6
    sensor_name: ForceTorqueControllerHandle
    sensor_ref_name: fts_base_link
    #endeffector_name: bottle_opener_tcp_link 
    endeffector_name: force_tool_tcp_link
    #endeffector_name: fts_tool_link
    wrench_sensor_topic: fts_topic
    cart_traj_wrench_topic: target_ik_wrench
    cart_traj_pose_topic: target_ik_pose
    

cart_hybrid_impedance_controller:
    type: inverse_dynamics_controllers/CartHybridImpedanceController
    #selection_matrix: [0, 0, 0, 1, 0, 0]
    selection_matrix: [1, 1, 1, 1, 1, 1]
    required_drive_mode: 7
    control_type: position_controlled # velocity_controlled, torque_controlled
    Kp:     [60.0,      60.0,       60.0,       80.0,       80.0,       80.0    ]
    Kd:     [5.0,       5.0,        5.0,        7.0,        7.0,        7.0     ]
    Km:     [0.1,       0.1,        0.1,        6.0,        6.0,        6.0     ] # normal behavior with 0.1 for force, and 6 for moment
    ForceController:
        pid_force_x:  {p: 0.0002, i: 0.005, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_y:  {p: 0.0002, i: 0.005, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_z:  {p: 0.000165, i: 0.006, d: 0.0, i_clamp: 3.0, publish_state: true} # p 0.00017-27 i: 0.0018-0.007 0.006  # 0.000165 and 0.006
        pid_torque_x: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        pid_torque_y: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        pid_torque_z: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        
        Frequency: 200.
    world_name: world #base
    root_name:  base_link
    tip_name:   link_6
    sensor_name: ForceTorqueControllerHandle
    sensor_ref_name: fts_base_link
    #endeffector_name: bottle_opener_tcp_link 
    endeffector_name: force_tool_tcp_link
    #endeffector_name: fts_tool_link
    wrench_sensor_topic: fts_topic
    cart_traj_wrench_topic: target_ik_wrench
    cart_traj_pose_topic: target_ik_pose

reflexxes_cart_hybrid_impedance_controller:
    type: inverse_dynamics_controllers/ReflexxesCartHybridImpedanceController
    #selection_matrix: [0, 0, 0, 1, 0, 0]
    selection_matrix: [1, 1, 1, 1, 1, 1]
    required_drive_mode: 7
    control_type: position_controlled # velocity_controlled, torque_controlled
    Kp:     [60.0,      60.0,       60.0,       80.0,       80.0,       80.0    ]
    Kd:     [15.0,       15.0,        15.0,        10.0,        10.0,        10.0     ]
    Km:     [0.1,       0.1,        0.1,        6.0,        6.0,        6.0     ] # normal behavior with 0.1 for force, and 6 for moment
    ForceController:
        pid_force_x:  {p: 0.0002, i: 0.005, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_y:  {p: 0.0002, i: 0.005, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_z:  {p: 0.000165, i: 0.006, d: 0.0, i_clamp: 3.0, publish_state: true} # p 0.00017-27 i: 0.0018-0.007 0.006  # 0.000165 and 0.006
        pid_torque_x: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        pid_torque_y: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        pid_torque_z: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}

        Frequency: 200.
    world_name: world #base
    root_name:  base_link
    tip_name_kdl: link_6
    tip_name: link_6
    sensor_name: ForceTorqueControllerHandle
    sensor_ref_name: fts_base_link
    #endeffector_name: bottle_opener_tcp_link 
    endeffector_name: force_tool_tcp_link
    wrench_sensor_topic: fts_topic
    cart_traj_wrench_topic: target_ik_wrench
    cart_traj_pose_topic: target_ik_pose
    group: "arm"
    ik_type: "r5_arm_kinematics/IKFastKinematicsPlugin"

    # reflexxes parameters
    reflexxes_period_: 0.004 #Default 0.004
    state_publish_rate: 50 # Defaults to 50
    action_monitor_rate: 20 # Defaults to 20
    max_velocity: 0.175 #0.175 # Max Axes Vel (default: 0.087)	rad/s
    max_acceleration: 1.745 #1.745 # Max Axes Accel (default: 13.963) rad

new_impedance_controller:
    type: impedance_controller/ForcePositionImpedanceController
    selection_matrix: [1, 1, 1, 1, 1, 1]
    required_drive_mode: 7
    control_type: position_controlled # velocity_controlled, torque_controlled
    Kp:     [60.0,      60.0,       60.0,       80.0,       80.0,       80.0    ]
    Kd:     [15.0,       15.0,        15.0,        10.0,        10.0,        10.0     ]
    Km:     [0.1,       0.1,        0.1,        6.0,        6.0,        6.0     ] # normal behavior with 0.1 for force, and 6 for moment
    ForceController:
        pid_force_x:  {p: 0.0002, i: 0.005, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_y:  {p: 0.0002, i: 0.005, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_z:  {p: 0.000165, i: 0.006, d: 0.0, i_clamp: 3.0, publish_state: true} # p 0.00017-27 i: 0.0018-0.007 0.006  # 0.000165 and 0.006
        pid_torque_x: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        pid_torque_y: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}
        pid_torque_z: {p: 0.0035,  i: 0.45,  d: 0.0, i_clamp: 7.0, publish_state: true}

        Frequency: 200.
    world_name: world #base
    root_name:  base_link
    tip_name_kdl: link_6
    tip_name: link_6
    sensor_name: ForceTorqueControllerHandle
    sensor_ref_name: fts_base_link
    #endeffector_name: bottle_opener_tcp_link
    endeffector_name: force_tool_tcp_link
    wrench_sensor_topic: fts_topic
    cart_traj_wrench_topic: target_ik_wrench
    cart_traj_pose_topic: target_ik_pose
    group: "arm"
    ik_type: "r5_arm_kinematics/IKFastKinematicsPlugin"

    # reflexxes parameters
    reflexxes_period_: 0.004 #Default 0.004
    state_publish_rate: 50 # Defaults to 50
    action_monitor_rate: 20 # Defaults to 20
    max_velocity: 0.175 #0.175 # Max Axes Vel (default: 0.087)	rad/s
    max_acceleration: 1.745 #1.745 # Max Axes Accel (default: 13.963) rad

jnt_hybrid_impedance_controller:
    type: inverse_dynamics_controllers/JntHybridImpedanceController
    #selection_matrix: [0, 0, 0, 1, 0, 0]
    selection_matrix: [1, 1, 1, 1, 1, 1]
    required_drive_mode: 7
    control_type: position_controlled # velocity_controlled, torque_controlled
    Kp:     [100.0,     100.0,      100.0,      100.0,      100.0,      100.0  ]
    Kd:     [7.0,       7.0,        7.0,        7.0,        7.0,        7.0    ]
    Km:     [2.0,       2.0,        2.0,        2.0,        2.0,        2.0    ]
    ForceController:
        pid_force_0: {p: 0.002, i: 0.05, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_1: {p: 0.002, i: 0.05, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_2: {p: 0.002, i: 0.05, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_3: {p: 0.002, i: 0.05, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_4: {p: 0.002, i: 0.05, d: 0.0, i_clamp: 3.0, publish_state: true}
        pid_force_5: {p: 0.002, i: 0.05, d: 0.0, i_clamp: 3.0, publish_state: true}
        
        Frequency: 200.
    world_name: world #base
    root_name:  base_link
    tip_name:   link_6
    sensor_name: ForceTorqueControllerHandle
    sensor_ref_name: fts_base_link
    #endeffector_name: bottle_opener_tcp_link 
    endeffector_name: force_tool_tcp_link
    #endeffector_name: fts_tool_link
    wrench_sensor_topic: fts_topic
    cart_traj_wrench_topic: target_ik_wrench
    cart_traj_pose_topic: target_ik_pose
    
# Admittance control
admittance_controller:
    type: force_controllers/AdmittanceController
    required_drive_mode: 7
             
    separation_matrix: [1,1,1,1,1,1]
    IK_base_frame: base_link
    IK_endeffector: tool0
    endeffector_frame:  grinder_tcp_link #calibration_tool_tcp_link
    controller_frame: base_link 
    world_frame: world
    sensor_frame: fts_base_link #fts_reference_link  # Check this out??
    group: "arm"
    ik_type: "r5_arm_kinematics/IKFastKinematicsPlugin"
